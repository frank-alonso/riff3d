---
phase: 02-closed-loop-editor
plan: 08
type: execute
wave: 6
depends_on: ["02-01", "02-02", "02-03", "02-04", "02-05", "02-06", "02-07"]
files_modified:
  - .planning/reviews/phase-2/PHASE_2_EVIDENCE.md
autonomous: false
requirements:
  - EDIT-01
  - EDIT-02
  - EDIT-03
  - EDIT-04
  - EDIT-05
  - EDIT-06
  - EDIT-07
  - EDIT-08
  - EDIT-09
  - EDIT-10
  - RNDR-01
  - RNDR-02
  - RNDR-03
  - RNDR-04
  - RNDR-05
  - ADPT-01
  - PROJ-01
  - PROJ-02
  - PROJ-03

must_haves:
  truths:
    - "All 19 Phase 2 requirements have been implemented and verified"
    - "All 5 Phase 2 success criteria can be demonstrated end-to-end"
    - "All Phase 2 carry-forward items (CF-01, CF-02, CF-03, CF-05, CF-06) are resolved; CF-04 is deferred to Phase 4/7 as planned"
    - "No S0 or S1 findings block Phase 2 completion"
    - "Codex review produces PASS or PASS_WITH_CONDITIONS gate decision"
  artifacts:
    - path: ".planning/reviews/phase-2/PHASE_2_EVIDENCE.md"
      provides: "Post-execution evidence packet"
      contains: "Success Criteria"
  key_links:
    - from: ".planning/reviews/phase-2/PHASE_2_EVIDENCE.md"
      to: "all Phase 2 plan SUMMARYs"
      via: "evidence references all plan outcomes"
      pattern: "02-0[1-7]-SUMMARY"
---

<objective>
Conduct the Phase 2 post-execution review following the Phase Review Protocol. The pre-execution plan review (advisory) is handled by /gsd:plan-phase â€” this plan covers the post-execution evidence audit with Codex as independent reviewer. The review validates all 19 requirements, 5 success criteria, and carry-forward resolution.

Purpose: Review gates ensure the foundation is solid before building on it. Phase 2 establishes the editor that all future phases build on. A thorough review prevents accumulated debt.
Output: Evidence packet, Codex review artifacts, gate decision (PASS, PASS_WITH_CONDITIONS, or FAIL).
</objective>

<execution_context>
@/home/frank/.claude/get-shit-done/workflows/execute-plan.md
@/home/frank/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/PHASE_REVIEW_PROTOCOL.md
@.planning/phases/02-closed-loop-editor/02-01-SUMMARY.md
@.planning/phases/02-closed-loop-editor/02-02-SUMMARY.md
@.planning/phases/02-closed-loop-editor/02-03-SUMMARY.md
@.planning/phases/02-closed-loop-editor/02-04-SUMMARY.md
@.planning/phases/02-closed-loop-editor/02-05-SUMMARY.md
@.planning/phases/02-closed-loop-editor/02-06-SUMMARY.md
@.planning/phases/02-closed-loop-editor/02-07-SUMMARY.md
@.planning/reviews/phase-2/PHASE_2_PLAN_SUMMARY.md
@.planning/reviews/phase-2/PHASE_2_PLAN_REVIEW.md
@.planning/reviews/phase-2/PHASE_2_PLAN_REVIEW_RESPONSE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compile evidence packet and run review</name>
  <files>
    .planning/reviews/phase-2/PHASE_2_EVIDENCE.md
  </files>
  <action>
    **Create evidence packet** (`.planning/reviews/phase-2/PHASE_2_EVIDENCE.md`):

    Compile evidence for each of the 5 Phase 2 success criteria:

    1. **"A user can log in, create a new project, and see it in their project dashboard with a thumbnail"**
       - Evidence: Auth flow works (social login -> callback -> session). Dashboard shows project cards. Thumbnails captured on save.
       - Reference: 02-01-SUMMARY (auth + dashboard), 02-05-SUMMARY (thumbnail capture)

    2. **"The 3D viewport renders a scene with PBR materials, lighting, and camera controls -- all powered by the PlayCanvas adapter reading Canonical IR"**
       - Evidence: Viewport renders. PBR materials display correctly. Camera orbit/fly works. Pipeline verified: ECSON -> IR -> PlayCanvas.
       - Reference: 02-02-SUMMARY (adapter + viewport)

    3. **"A user can add entities, move/rotate/scale them with gizmos, edit properties in the inspector, reparent in the hierarchy tree, and every edit flows through PatchOps"**
       - Evidence: Gizmos produce PatchOps on transform:end. Inspector dispatches SetComponentProperty ops. Reparent dispatches Reparent op. All verifiable via undo stack.
       - Reference: 02-03-SUMMARY (gizmos), 02-04-SUMMARY (hierarchy + inspector)

    4. **"Undo/redo works across all edit types, and auto-save persists the ECSON document"**
       - Evidence: Undo/redo stacks. Auto-save with 5s debounce. Ctrl+S manual save. Browser close/reopen restores state.
       - Reference: 02-05-SUMMARY (undo/redo + save)

    5. **"Pressing Play transitions to runtime mode without page reload, and Stop returns to editor with edits preserved"**
       - Evidence: Play/Pause/Stop cycle. ECSON snapshot/restore. Scene matches pre-play state after Stop.
       - Reference: 02-07-SUMMARY (play-test mode)

    **Carry-forward resolution table:**
    | CF | Description | Resolution | Reference |
    |----|-------------|------------|-----------|
    | CF-01 | Nightly property tests | Added rotating-seed tests with 1000 iterations | 02-05 |
    | CF-02 | Lossiness contract tests | Added explicit field enumeration tests | 02-05 |
    | CF-03 | Mutation bypass enforcement | Added freeze + negative test | 02-05 |
    | CF-05 | Unused eslint-disable | Removed | 02-01 |
    | CF-06 | IR convention docs | JSDoc in adapter source | 02-02 |

    **Requirement coverage matrix:** List all 19 requirements with implementing plan and verification status.

    **Run Codex review:**
    ```bash
    ./scripts/codex-review.sh post-review 2
    ```

    Wait for Codex review. Write response addressing any findings. Run final review for gate decision.

    ```bash
    ./scripts/codex-review.sh final-review 2
    ```
  </action>
  <verify>
    - Evidence packet exists with all 5 success criteria addressed
    - All 19 requirements mapped to implementing plans
    - All carry-forwards resolved
    - Codex review script runs successfully
  </verify>
  <done>
    Phase 2 evidence packet compiled. All success criteria evidenced. Carry-forwards resolved. Codex review executed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Full Phase 2 end-to-end verification</name>
  <files>.planning/reviews/phase-2/PHASE_2_EVIDENCE.md</files>
  <action>
    Human verification of the complete closed-loop editor. Claude has compiled the evidence packet -- this checkpoint verifies the full golden path works end-to-end.

    What was built: Complete closed-loop editor: auth, dashboard, 3D viewport with PlayCanvas, transform gizmos, hierarchy tree, inspector, undo/redo, copy/paste, save/auto-save, asset browser, GLB import, environment settings, play-test mode.

    Golden path test (should take 5-10 minutes):

    1. Open http://localhost:3000 and log in via social auth
    2. Create a new project from the dashboard (should see default scene with ground plane, cube, sphere, light)
    3. In the editor:
       a. Click the cube in the viewport or hierarchy tree -- it should select with visual highlight
       b. Move the cube with the translate gizmo (drag an axis)
       c. Press E to switch to rotate gizmo, rotate the cube
       d. Check the inspector panel -- transform values should reflect the changes
       e. Press Ctrl+Z twice to undo both edits -- cube should return to original position
       f. Press Ctrl+Shift+Z to redo
    4. In the hierarchy:
       a. Drag the sphere onto the cube to reparent it
       b. Verify the sphere moves with the cube
       c. Right-click -> Add Entity -> Point Light
    5. In the inspector:
       a. Select the light entity
       b. Change its color and intensity
       c. See the lighting change in the viewport
    6. Asset browser:
       a. Click the Assets tab in the activity bar
       b. Drag a cylinder from the asset browser to the viewport
       c. Try importing a GLB file if you have one available
    7. Environment:
       a. Change ambient light color
       b. Enable fog and adjust density
       c. See changes in viewport
    8. Save:
       a. Wait 5 seconds -- should auto-save (top bar shows "Saving..." then "Saved")
       b. Press Ctrl+S for manual save
       c. Refresh the browser -- scene should restore exactly
    9. Play-test:
       a. Press the Play button (or Ctrl+P)
       b. Verify: colored border appears, panels collapse, gizmos disappear
       c. Press Pause -- simulation freezes
       d. Press Stop -- scene restores to pre-play state, panels expand
    10. Verify dark theme is consistent throughout all interactions

    If any step fails, describe the issue for gap closure.
  </action>
  <verify>User confirms all 10 golden path steps pass by typing "approved"</verify>
  <done>Full Phase 2 golden path verified end-to-end by user. Gate decision recorded.</done>
</task>

</tasks>

<verification>
- All 19 requirements implemented and verifiable
- All 5 success criteria demonstrated end-to-end
- Carry-forward items resolved
- Codex review completed with gate decision
- Full golden path test passed by human
</verification>

<success_criteria>
- Phase 2 passes Codex review with PASS or PASS_WITH_CONDITIONS
- Human verifies the full golden path (auth -> create -> edit -> undo -> save -> play -> stop)
- No S0 or S1 findings remaining
- All Phase 1 carry-forwards resolved
</success_criteria>

<output>
After completion, create `.planning/phases/02-closed-loop-editor/02-08-SUMMARY.md`
Update `.planning/STATE.md` with Phase 2 completion status.
Update `.planning/ROADMAP.md` progress table.
</output>
